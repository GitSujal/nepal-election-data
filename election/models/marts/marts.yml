version: 2

models:
  - name: dim_fptp_candidates
    description: >
      Dimension table for current (2082 BS) FPTP candidates, enriched with
      previous election performance (2079 and 2074 BS), parliament membership
      history, party merger awareness, tourist candidate flag, education change
      tracking, and candidate type classification
      (Chheparo / Vaguwa / Same Location / New Candidate).
    columns:
      - name: candidate_id
        description: Unique identifier for the candidate
      - name: candidate_name
        description: Full name of the candidate (Devanagari)
      - name: gender
        description: Gender of the candidate
      - name: age
        description: Age of the candidate in years
      - name: age_group
        description: Age bucket (Below 30, 30-50, 50-60, 60+)
      - name: date_of_birth
        description: Date of birth
      - name: father_name
        description: Father's name
      - name: spouse_name
        description: Spouse's name
      - name: qualification
        description: Educational qualification (raw)
      - name: qualification_level
        description: Mapped qualification level from qualification_level_mapping seed
      - name: institution_name
        description: Name of educational institution
      - name: address
        description: Residential address
      - name: experience
        description: Professional experience
      - name: other_details
        description: Other details about the candidate
      - name: symbol_code
        description: Election symbol code
      - name: symbol_name
        description: Name of the election symbol
      - name: political_party_name
        description: Current political party name
      - name: state_id
        description: State/Province identifier
      - name: state_name
        description: State/Province name
      - name: district_id
        description: District identifier (from districts reference)
      - name: district_name
        description: District name where contesting
      - name: constituency_id
        description: Constituency identifier
      - name: constituency_name
        description: Constituency name
      - name: citizenship_district
        description: Citizenship district of the candidate
      - name: election_status
        description: Election status code
      - name: current_vote_received
        description: Votes received in the current election
      - name: rank_position
        description: Rank/position in results
      - name: prev_election_votes
        description: Votes received in the 2079 BS election
      - name: prev_election_rank
        description: Rank in the 2079 BS election
      - name: prev_election_remarks
        description: Remarks from 2079 BS election (e.g. 'Elected')
      - name: prev_election_result
        description: Derived result â€” Winner or Loser (2079)
      - name: prev_election_party
        description: Political party in the 2079 BS election
      - name: prev_election_state
        description: State contested in during 2079 BS election
      - name: prev_election_district
        description: District contested in during 2079 BS election
      - name: prev_election_district_cd
        description: District code from 2079 BS election
      - name: prev_election_constituency_id
        description: Constituency ID from 2079 BS election
      - name: prev_election_casted_vote
        description: Total votes cast in the 2079 BS constituency
      - name: prev_election_total_voters
        description: Total registered voters in the 2079 BS constituency
      - name: prev_qualification
        description: Qualification reported in 2079 BS election
      - name: prev_qualification_level
        description: Mapped qualification level from 2079 BS election
      - name: prev_2074_election_votes
        description: Votes received in the 2074 BS election
      - name: prev_2074_election_result
        description: Derived result â€” Winner or Loser (2074)
      - name: prev_2074_election_party
        description: Political party in the 2074 BS election
      - name: prev_2074_election_district
        description: District contested in during 2074 BS election
      - name: prev_2074_election_constituency_id
        description: Constituency ID from 2074 BS election
      - name: elections_contested
        description: Count of past FPTP elections contested (0, 1, or 2)
      - name: was_parliament_member_2074
        description: Whether candidate was a parliament member in 2074
      - name: parliament_member_2074_election_type
        description: Election type (FPTP/Proportional) for 2074 parliament term
      - name: was_parliament_member_2079
        description: Whether candidate was a parliament member in 2079
      - name: parliament_member_2079_election_type
        description: Election type (FPTP/Proportional) for 2079 parliament term
      - name: is_same_party_after_merger_check
        description: Whether the current party matches the 2079 party after accounting for mergers/renames
      - name: is_same_party_2074_after_merger_check
        description: Whether the current party matches the 2074 party after accounting for mergers/renames
      - name: is_tourist_candidate
        description: Whether citizenship district differs from candidacy district
      - name: is_education_changed
        description: Whether qualification level changed between 2079 and current
      - name: is_chheparo
        description: Whether the candidate switched to a genuinely different party
      - name: is_vaguwa
        description: Whether the candidate moved to a different district or constituency
      - name: is_new_candidate
        description: Whether the candidate did not contest in any previous election
      - name: is_loyal
        description: Whether the candidate stayed with same party and constituency across all elections
      - name: is_proportional_veteran
        description: Whether the candidate was a proportional parliament member in a past election
      - name: candidate_type
        description: Classification â€” Chheparo, Vaguwa, Same Location, or New Candidate

  - name: dim_fptp_2079_candidates
    description: >
      Dimension table for 2079 BS FPTP candidates, enriched with 2074 BS
      previous election performance, parliament membership history, party
      merger awareness, tourist candidate flag, and candidate type classification.
      Same tag structure as dim_fptp_candidates but for the 2079 election cycle.
    columns:
      - name: candidate_id
        description: Unique identifier for the candidate
      - name: candidate_name
        description: Full name of the candidate (Devanagari)
      - name: gender
        description: Gender of the candidate
      - name: age
        description: Age at the time of the 2079 BS election
      - name: age_group
        description: Age bucket (Below 30, 30-50, 50-60, 60+)
      - name: date_of_birth
        description: Date of birth
      - name: qualification
        description: Educational qualification (raw)
      - name: qualification_level
        description: Mapped qualification level
      - name: political_party_name
        description: Political party name in 2079
      - name: state_name
        description: State/Province name
      - name: district_name
        description: District name where contesting
      - name: constituency_id
        description: Constituency identifier
      - name: citizenship_district
        description: Citizenship district
      - name: total_votes_received
        description: Total votes received in 2079
      - name: rank_position
        description: Rank in 2079 results
      - name: election_result
        description: Derived result â€” Winner or Loser
      - name: prev_2074_election_votes
        description: Votes received in the 2074 BS election
      - name: prev_2074_election_result
        description: Derived result â€” Winner or Loser (2074)
      - name: prev_2074_election_party
        description: Political party in the 2074 BS election
      - name: prev_2074_election_district
        description: District contested in during 2074 BS election
      - name: elections_contested
        description: Count of past FPTP elections contested (0 or 1)
      - name: was_parliament_member_2074
        description: Whether candidate was a parliament member in 2074
      - name: parliament_member_2074_election_type
        description: Election type (FPTP/Proportional) for 2074 parliament term
      - name: was_parliament_member_2079
        description: Whether candidate was a parliament member in 2079 (this term)
      - name: parliament_member_2079_election_type
        description: Election type (FPTP/Proportional) for 2079 parliament term
      - name: is_tourist_candidate
        description: Whether citizenship district differs from candidacy district
      - name: is_chheparo
        description: Whether the candidate switched party compared to 2074
      - name: is_vaguwa
        description: Whether the candidate moved district/constituency from 2074
      - name: is_new_candidate
        description: Whether the candidate did not contest in 2074
      - name: is_loyal
        description: Whether the candidate stayed with same party and constituency from 2074
      - name: is_proportional_veteran
        description: Whether the candidate was a proportional parliament member in 2074
      - name: candidate_type
        description: Classification â€” Chheparo, Vaguwa, Same Location, or New Candidate

  - name: dim_current_proportional_candidates
    description: >
      Dimension table for current (2082 BS) proportional representation
      candidates, joined to dim_parties for party identification.
    columns:
      - name: serial_no
        description: Serial number of the candidate within the party list
      - name: full_name
        description: Full name of the candidate (Devanagari)
      - name: voter_id_number
        description: Voter ID number
      - name: gender
        description: Gender of the candidate
      - name: inclusive_group
        description: Inclusive group category (e.g. à¤†à¤¦à¤¿à¤µà¤¾à¤¸à¥€ à¤œà¤¨à¤œà¤¾à¤¤à¤¿, à¤®à¤§à¥‡à¤¶à¥€)
      - name: citizenship_district
        description: District of citizenship
      - name: backward_area
        description: Whether the candidate is from a backward area
      - name: disability
        description: Whether the candidate has a disability
      - name: associated_party
        description: Associated political party when multiple parties combine under a single symbol
      - name: remarks
        description: Additional remarks
      - name: political_party_name
        description: Political party name as listed in the source
      - name: party_id
        description: Party ID from dim_parties, matched on political_party_name first then associated_party as fallback
      - name: matched_party_name
        description: The party name that successfully matched in dim_parties
      - name: party_previous_names
        description: List of previous party names from dim_parties

  - name: dim_constituency_profile
    description: >
      Dimension table for constituency profiles, containing election results
      from both 2079 BS and 2074 BS for FPTP elections, and 2079 BS for
      proportional elections. Each constituency stores complete results as JSON
      objects, winning parties, and a "Gadh" tag if the same party won in both years.
    columns:
      - name: state_id
        description: State/Province identifier
      - name: state_name
        description: State/Province name
      - name: district_id
        description: District identifier
      - name: district_name
        description: District name
      - name: constituency_id
        description: Constituency identifier
      - name: constituency_name
        description: Constituency name
      - name: fptp_2079_results
        description: >
          JSON array of FPTP results from 2079 BS election, ordered by rank.
          Each object contains: candidate_name, party_name, symbol_name, vote_count, rank, remarks
      - name: fptp_2074_results
        description: >
          JSON array of FPTP results from 2074 BS election, ordered by rank.
          Each object contains: candidate_name, party_name, symbol_name, vote_count, rank, remarks
      - name: proportional_2079_results
        description: >
          JSON array of proportional election results from 2079 BS, ordered by rank.
          Each object contains: party_name, vote_count, rank
      - name: winning_party_2079
        description: Party that won the FPTP election in 2079 BS
      - name: winning_party_2074
        description: Party that won the FPTP election in 2074 BS
      - name: is_gadh
        description: >
          Flag indicating if the same party (accounting for mergers/renames)
          won the constituency in both 2079 and 2074 FPTP elections
      - name: gadh_party_name
        description: Name of the party for which this constituency is a "Gadh" (stronghold)
      - name: tags
        description: >
          Array of tags for the constituency. Currently includes "Gadh: {party_name}"
          if the constituency is a stronghold for a particular party

  - name: dim_parliament_members
    description: >
      Dimension table of House of Representatives members aggregated across
      2074 and 2079 BS terms. Uses 3-tier name matching (exact â†’ normalized â†’
      manual seed mapping via parliament_member_name_mapping) to consolidate
      the same person across terms. Tracks party switching, election types,
      districts, and constituencies per term.
    columns:
      - name: parliament_member_id
        description: Unique identifier assigned via row_number() ordered by name_np
      - name: name_normalized
        description: Unified normalized Devanagari name used for cross-term matching
      - name: name_np
        description: Display name in Nepali (from latest term)
      - name: name_en
        description: Display name in English (from latest term)
      - name: gender
        description: Gender of the member
      - name: dob
        description: Date of birth
      - name: times_elected
        description: Number of times elected to parliament (1 or 2)
      - name: parties_np
        description: List of distinct party names (Nepali) across terms
      - name: parties_en
        description: List of distinct party names (English) across terms
      - name: is_party_switcher
        description: Whether the member was in different parties across terms
      - name: terms_bs
        description: List of BS years the member was elected (e.g. [2074, 2079])
      - name: election_types
        description: List of election types per term (FPTP or Proportional)
      - name: districts_np
        description: List of district names per term
      - name: election_areas
        description: List of constituency numbers per term
      - name: latest_term_bs
        description: Most recent term (BS year)
      - name: was_member_2074
        description: Whether the member served in the 2074 term
      - name: was_member_2079
        description: Whether the member served in the 2079 term
      - name: party_2074_np
        description: Party name (Nepali) during 2074 term, null if not a member
      - name: party_2079_np
        description: Party name (Nepali) during 2079 term, null if not a member
      - name: election_type_2074
        description: Election type in 2074 (FPTP or Proportional)
      - name: election_type_2079
        description: Election type in 2079 (FPTP or Proportional)
      - name: district_2074_np
        description: District name (Nepali) in 2074
      - name: district_2079_np
        description: District name (Nepali) in 2079
      - name: election_area_2074
        description: Constituency number in 2074
      - name: election_area_2079
        description: Constituency number in 2079

  - name: dim_parties
    description: >
      Master dimension table of political parties with current names, lists of
      previous names (from party_current_new_name_mapping seed), and metadata
      from Wikipedia (symbol, leader, founding year). Includes proportional-only
      parties not mapped to any FPTP party. Used by other marts for merger-aware
      party comparison via list_contains(previous_names, ...).
    columns:
      - name: party_id
        description: Unique identifier assigned via row_number() ordered by current_party_name
      - name: current_party_name
        description: Current (2082 BS) party name
      - name: previous_names
        description: List of previous party names from merger/rename history
      - name: symbol_url
        description: URL to the party's election symbol image (from Wikipedia)
      - name: symbol_alt
        description: Alt text for the party symbol image
      - name: leader
        description: Current party leader name
      - name: founded_year
        description: Year the party was founded
      - name: wikipedia_url
        description: Wikipedia URL for the party

  - name: dim_parties_profile
    description: >
      Party-level analytical profile combining historical election performance
      (2074 and 2079 FPTP/PR stats, parliament membership counts) with current
      2082 candidate composition (FPTP and PR). Returns complex JSON structures
      for history and current stats. Generates party-level tags like
      "Budo Party" (avg age > 55), "Same Same" (>50% returning candidates),
      "Naya Anuhar" (>50% new candidates).
    columns:
      - name: party_id
        description: Party identifier from dim_parties
      - name: party_name
        description: Current party name
      - name: symbol_url
        description: URL to the party's election symbol image
      - name: symbol_alt
        description: Alt text for the party symbol image
      - name: leader
        description: Current party leader name
      - name: founded_year
        description: Year the party was founded
      - name: wikipedia_url
        description: Wikipedia URL for the party
      - name: history_json
        description: >
          Nested JSON with historical performance: parliament membership counts
          (reps_2079, fptp_reps_2079, pr_reps_2079, reps_2074, etc.), FPTP stats
          (candidate_count, seats_won, total_votes per year), PR stats (total_votes per year)
      - name: current_stats_json
        description: >
          Nested JSON with current 2082 candidate composition: FPTP aggregates
          (avg_age, new_vs_returning, qualification/gender/district/age_group breakdowns)
          and PR aggregates (count, gender, inclusive_group, district, disability breakdowns)
      - name: party_tags
        description: >
          Array of party-level tags: "Budo Party ğŸ‘´" (avg candidate age > 55),
          "Same Same ğŸ‘¯" (>50% returning candidates), "Naya Anuhar ğŸ§’" (>50% new candidates)
